import{j as e}from"./games-5oCbjJpc.js";import{r as t}from"./three-DxcQGzY8.js";const s=({serverUrl:s,onClose:n})=>{const r=t.useRef(null),[l,a]=t.useState(!1),[c,i]=t.useState(!0),o=t.useRef(null),d=t.useRef(null);t.useEffect(()=>((async()=>{try{const e=new WebSocket(s);o.current=e,e.onopen=()=>{a(!0)},e.onmessage=async t=>{var s;const n=JSON.parse(t.data);if("offer"===n.type){const t=new RTCPeerConnection({iceServers:[{urls:"stun:stun.l.google.com:19302"}]});d.current=t,t.ontrack=e=>{r.current&&e.streams[0]&&(r.current.srcObject=e.streams[0],i(!1))},await t.setRemoteDescription(new RTCSessionDescription(n.sdp));const s=await t.createAnswer();await t.setLocalDescription(s),e.send(JSON.stringify({type:"answer",sdp:s}))}else"iceCandidate"===n.type&&await(null==(s=d.current)?void 0:s.addIceCandidate(new RTCIceCandidate(n.candidate)))},e.onerror=e=>{i(!1)}}catch(e){i(!1)}})(),()=>{var e,t;null==(e=d.current)||e.close(),null==(t=o.current)||t.close()}),[s]);return e.jsxs("div",{className:"fixed inset-0 z-50 bg-black flex flex-col",children:[e.jsxs("div",{className:"bg-slate-900/90 backdrop-blur-sm p-4 flex items-center justify-between border-b border-slate-700",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("h2",{className:"text-xl font-bold text-white",children:"City Builder - UE5"}),l&&e.jsxs("span",{className:"flex items-center gap-2 text-green-400 text-sm",children:[e.jsx("span",{className:"w-2 h-2 bg-green-400 rounded-full animate-pulse"}),"Connected"]})]}),e.jsx("button",{onClick:n,className:"px-4 py-2 bg-slate-700 hover:bg-slate-600 rounded-lg text-white transition-colors",children:"Exit"})]}),e.jsxs("div",{className:"flex-1 relative bg-black flex items-center justify-center",children:[c&&e.jsxs("div",{className:"absolute inset-0 flex flex-col items-center justify-center gap-4 z-10",children:[e.jsx("div",{className:"w-16 h-16 border-4 border-cyan-500 border-t-transparent rounded-full animate-spin"}),e.jsx("p",{className:"text-white text-lg",children:"Connecting to UE5 Server..."}),e.jsx("p",{className:"text-slate-400 text-sm",children:"Starting Unreal Engine instance"})]}),e.jsx("video",{ref:r,autoPlay:!0,playsInline:!0,className:"w-full h-full object-contain cursor-pointer",onMouseMove:e=>{if(!o.current||!l)return;const t=e.currentTarget.getBoundingClientRect(),s=(e.clientX-t.left)/t.width*100,n=(e.clientY-t.top)/t.height*100;o.current.send(JSON.stringify({type:"mouseMove",x:s,y:n}))},onClick:e=>{o.current&&l&&o.current.send(JSON.stringify({type:"mouseClick",button:e.button}))},style:{display:c?"none":"block"}}),!c&&!l&&e.jsxs("div",{className:"absolute inset-0 flex flex-col items-center justify-center gap-4 bg-black/80",children:[e.jsx("p",{className:"text-red-400 text-xl",children:"Connection Failed"}),e.jsx("p",{className:"text-slate-400",children:"Unable to connect to UE5 server"}),e.jsx("button",{onClick:n,className:"px-6 py-2 bg-cyan-500 hover:bg-cyan-600 rounded-lg text-white transition-colors",children:"Back to Menu"})]})]}),l&&!c&&e.jsx("div",{className:"bg-slate-900/90 backdrop-blur-sm p-3 border-t border-slate-700",children:e.jsxs("div",{className:"flex items-center justify-center gap-6 text-sm text-slate-400",children:[e.jsx("span",{children:"üñ±Ô∏è Click to build"}),e.jsx("span",{children:"‚å®Ô∏è WASD to move camera"}),e.jsx("span",{children:"üîç Scroll to zoom"})]})})]})};export{s as UE5PixelStream};
